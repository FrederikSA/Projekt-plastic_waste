<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plastic in the Ocean</title>
    <link rel="stylesheet" href="styles.css"> <!-- Link til styles.css -->
    
</head>
<body>
    <header>
        <h1>Plastic in the Ocean</h1>
        <nav>
            <ul>
                <li><a href="#world-map">Plastic in the ocean</a></li>
                <li><a href="#plastic-end">Where do plastic end up?</a></li>
                <li><a href="#plastic-production">Global plastic production</a></li>
                <li><a href="#comparison">Plastic comparison by water</a></li>
            </ul>
        </nav>
        
        <!-- Load worldmap d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>

    </header>
    
    <!-- Front_page earth chart section -->
    <section id="world-map">
        <div class="map-header">
            <div id="map-container">
                <svg id="my_dataviz" width="1300" height="700"></svg>
            </div>
            <script>
                // Farveskala
                var colorScale = d3.scaleLog()
                    .domain([0.000000001, 0.0005, 0.005, 0.05, 0.5, 1, 1.5, 2, 2.5, 3, 3.3]) // Tre trin: lave værdier, mellem, og outliers
                    .range(["#cee7f3", "#67a9cf", "#4093c3", "#32779e", "#2166ac", "#1d5997"]); // Fra lys blå til mørkere toner
            
                // The svg
                var svg = d3.select("svg"),
                    width = +svg.attr("width"),
                    height = +svg.attr("height");
            
                // Map and projection
                var projection = d3.geoNaturalEarth1()
                    .scale(width / 1.8 / Math.PI) // Reducerer skalaen en smule
                    .translate([width / 2, height / 1.8]); // Justerer fokuspunktet for bedre centreret visning
            
                // Funktion til at give mig data hvis vi har data og ellers give mig Data mangler
                function waste(countrydata) {
                    if (countrydata.length === 0) 
                        return "Data mangler"
                    else 
                        return countrydata[0].waste_kg_per_capita
                }
            
                // Funktion til at hente farve baseret på landets plastikdata
                function getCountryColor(countryId) {
                    return new Promise((resolve) => {
                        // Henter data for landet
                        d3.json("/api/countries?countryId=" + countryId, function(countrydata) {
                            if (countrydata.length === 0) {
                                resolve("#ff0000"); // Rød farve for lande uden data
                            } else {
                                var plasticAmount = +countrydata[0].waste_kg_per_capita;
                                resolve(colorScale(plasticAmount)); // Returner farven for lande med data
                            }
                        });
                    });
                }

                // Load external data and boot
                d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson", function(data) {
                    // Draw the map
                    svg.append("g")
                        .selectAll("path")
                        .data(data.features)
                        .enter().append("path")
                            .attr("d", d3.geoPath()
                                .projection(projection)
                            )
                            .style("stroke", "#fff")
                            .each(function(d) {
                                // Hent farve til hvert land og opdater
                                getCountryColor(d.id).then(color => {
                                    d3.select(this).attr("fill", color || "#ccc"); // Default farve, hvis der mangler data
                                });
                            })
                            .on("click", function(d) {
                                d3.json("/api/countries?countryId=" + d.id, function(countrydata) {
                                    console.log(countrydata);
                                });
                            })
                            .on("mouseover", function(d) { 
                                const event = d3.event;
            
                                // Fjern dæmpning fra det aktuelle land
                                d3.select(this).classed("highlight", true);

                                // Tilføj dæmpning til alle andre lande
                                d3.selectAll("path").classed("dim", true);
                                d3.select(this).classed("dim", false);
            
                                // Hent data for landet
                                d3.json("/api/countries?countryId=" + d.id, function(countrydata) {
                                    d3.select(".tooltip").remove();
            
                                    // Tilføjer en simpel pop-up (tooltip) med data fra API'en
                                    d3.select("body").append("div")
                                        .attr("class", "tooltip")
                                        .style("position", "absolute")
                                        .style("background", "#ffffff")
                                        .style("color", "#000000")
                                        .style("padding", "5px")
                                        .style("border", "1px solid #ccc")
                                        .style("border-radius", "5px")
                                        .style("pointer-events", "none")
                                        .style("top", (event.pageY - 20) + "px")
                                        .style("left", (event.pageX + 20) + "px")
                                        .html(`
                                            <strong>Country:</strong> ${d.properties.name || "Ukendt land"}<br>
                                            <strong>Waste per capita in kg:</strong> ${waste(countrydata)}
                                        `);
                                });
                            })
                            .on("mouseout", function() {
                            // Fjern highlight fra alle lande
                            d3.selectAll("path").classed("highlight", false).classed("dim", false);

                            // Fjern tooltip
                            d3.select(".tooltip").remove();
                            });
                });
            </script>                    
        </div>
    </section>
    

    <!-- Where plastic ends section -->
    <section id="plastic-end">
        <div class="plastic_e">
            <h2>Where do plastic end up? (Stacked bar char)</h2>
            <p>Vi er dedikeret til at bringe havets ro og skønhed til dig.</p>
        </div>
    </section>
    
    
    <!-- Plastic production section -->
    <section id="plastic-production">
        <div class="plastic-p">
            <h2>Global plastic production (Udviklings kurv)</h2>
            <p>Vil du i kontakt med os? Send en besked!</p>
        </div>
    </section>

    <!-- Comparison section -->
    <section id="comparison">
        <div class="plastic_c">
            <h2>Plastic comparison by water (Dråbe der sammenligner vand med plast i havet)</h2>
            <p>Verdenshavet dækker omkring 71% af Jordens overflade og indeholder 97% af al vandet på planeten. Gennemsnitsdybden er cirka 3.688 meter.</p>
        </div>
    </section>

</body>
</html>